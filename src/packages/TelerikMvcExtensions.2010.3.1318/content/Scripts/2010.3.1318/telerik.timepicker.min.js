(function(a){var b=a.telerik;b.timeView=function(c){a.extend(this,c);var d=this.dropDown=new b.dropDown({attr:this.dropDownAttr,effects:this.effects,onClick:function(f){var g=f.item;c.onChange(g.innerText||g.textContent)}});d.$element.addClass("t-time-popup").css("direction",this.isRtl?"rtl":"")};b.timeView.prototype={_ensureItems:function(){if(!this.dropDown.$items){this.bind()}},open:function(c){this._ensureItems();this.dropDown.open(c)},close:function(){this.dropDown.close()},bind:function(){var j=b.timeView.getTimeMilliseconds;var g=[];var c=this.format;var n=this.interval;var p=this.minValue;var d=j(p);var f=j(this.maxValue);var l=n*b.datetime.msPerMinute;var k=parseInt(b.datetime.msPerDay/(n*b.datetime.msPerMinute));if(d!=f){var o=d<f?f-d:f+b.datetime.msPerDay-d;k=parseInt(o/l)+1}var m=b.datetime.add;var e=b.datetime.format;for(var h=0;h<k;h++){g[h]=e(p.toDate(),c);p=m(p,l)}if(j(p)-l-f!=0&&d!=f){g[k]=e(this.maxValue.toDate(),c)}this.dropDown.dataBind(g)},isOpened:function(){return this.dropDown.isOpened()},value:function(c){this._ensureItems();var e=this.dropDown;if(c===undefined){return e.$items.filter(".t-state-selected").text()}var d=e.$items;if(!d){return}d.removeClass("t-state-selected");if(c){e.highlight(a.grep(d,function(f){return(f.innerText||f.textContent)==c}))}},navigate:function(i){var g=i.keyCode||i.which;if(g==38||g==40){i.preventDefault()}this._ensureItems();var d=this.dropDown;var f=d.$items;var h=f.filter(".t-state-selected");var c=h.length==0||f.length==1?f.first():(g==38)?h.prev():(g==40)?h.next():[];if(c.length){var j=c.text();d.scrollTo(c[0]);d.highlight(c[0]);if(!d.isOpened()){this.onChange(j)}else{this.onNavigateWithOpenPopup(j)}}}};a.each(["min","max"],a.proxy(function(d,c){b.timeView.prototype[c]=function(f){var e=c+"Value";if(f===undefined){return this[e].toDate()}this[e]=f.value?f:new b.datetime(f);this.bind()}},this));a.extend(b.timeView,{isInRange:function(c,j,g){if(c===null){return true}var f=b.timeView.getTimeMilliseconds;var d=b.datetime.msPerDay;var i=f(c);var e=f(j);var h=f(g);i=e>i?i+d:i;h=e>h?h+d:h;return e-h==0||i>=e&&i<=h},getTimeMilliseconds:function(c){return((c.hours()*60)+c.minutes())*b.datetime.msPerMinute+c.seconds()*1000+c.milliseconds()}});b.timepicker=function(d,e){a.extend(this,e);this.element=d;this.$element=a(d);var f=this.$input=a(".t-input",d).attr("autocomplete","off").bind({change:function(g){g.stopPropagation()},keydown:a.proxy(this._keydown,this),focus:a.proxy(function(g){this._change(f.val());this._open();this.$input.removeClass("t-state-error")},this)});this.timeView=new b.timeView({effects:this.effects,dropDownAttr:this.dropDownAttr,format:this.format,interval:this.interval,isRtl:f.closest(".t-rtl").length,minValue:this.minValue,maxValue:this.maxValue,onNavigateWithOpenPopup:a.proxy(function(g){this.$input.val(g)},this),onChange:a.proxy(function(g){this._change(g);this._close()},this)});this.inputValue=f.val();var c=this.selectedValue||this.inputValue;if(c){this._value(this.parse(c))}a(".t-icon",d).bind("click",this.enabled?a.proxy(this._togglePopup,this):b.preventDefault);a(document.documentElement).bind("mousedown",a.proxy(function(i){var g=this.timeView.dropDown.$element;var h=g&&g.parent().length>0;if(!h||a.contains(this.element,i.target)||a.contains(g.parent()[0],i.target)){return}this._change(this.$input.val());this._close()},this));b.bind(this,{open:this.onOpen,close:this.onClose,change:this.onChange,load:this.onLoad})};b.timepicker.prototype={_close:function(){var c=this.timeView.dropDown;if(!c.$element.is(":animated")&&c.isOpened()){this._trigger("close")}},_open:function(){if(!this.timeView.isOpened()){this._trigger("open")}},_trigger:function(c){if(!b.trigger(this.element,c)){this[c]()}},_togglePopup:function(){if(this.timeView.isOpened()){this._change(this.$input.val());this._close()}else{this.$input[0].focus()}},_change:function(c){var k=this.minValue;var e=this.maxValue;var i=this.parse(c);var m=this.selectedValue;if(!b.timeView.isInRange(i,k,e)){var d=b.timeView.getTimeMilliseconds;var h=d(i);var f=d(k);var l=d(e);var j=Math.abs(f-h);var g=Math.abs(l-h);i=new b.datetime(j<g?k.value:e.value)}if(i==null||this.inputValue!=c){this._value(i);if((m===null&&i!==null)||(m!==null&&i===null)||(m&&i&&(m.value>i.value||i.value>m.value))){b.trigger(this.element,"change",{previousValue:m===null?null:m.toDate(),value:i===null?null:i.toDate()})}}},_value:function(c){var e=this.$input.val();var d=c===null;this.selectedValue=c;this.timeView.value(d?null:b.datetime.format(c.toDate(),this.format));if(!d){e=b.datetime.format(c.toDate(),this.format)}this.inputValue=e;this.$input.toggleClass("t-state-error",d&&e!="").val(e)},_keydown:function(h){var f=h.keyCode||h.which;var d=h.target.value;var c=this.timeView.dropDown;if(h.altKey){if(f==40){this._open()}else{if(f==38){this._close()}}}if(!h.shiftKey&&f==38||f==40){this.timeView.navigate(h)}if(f==9||f==13||f==27){if(c.isOpened()&&f!=9){h.preventDefault()}var i;var g=this.timeView.value();if(this.inputValue!=d||!g){i=d}else{i=g}this._change(i);this._close()}},enable:function(){this.$input.attr("disabled",false);this.$element.removeClass("t-state-disabled").find(".t-icon").unbind("click").bind("click",a.proxy(this._togglePopup,this))},disable:function(c){this.$input.attr("disabled",true);this.$element.addClass("t-state-disabled").find(".t-icon").unbind("click").bind("click",b.preventDefault)},value:function(c){if(c===undefined){return this.selectedValue===null?null:this.selectedValue.toDate()}var d=this.parse(c);d=b.timeView.isInRange(d,this.minValue,this.maxValue)?d:null;if(d===null){this.$input.removeClass("t-state-error").val("")}this._value(d);return this},parse:function(c){if(c===null||c.value){return c}return c.getDate?new b.datetime(c):b.datetime.parse({AM:b.cultureInfo.AM,PM:b.cultureInfo.PM,value:c,format:this.format,baseDate:this.selectedValue?new b.datetime(this.selectedValue.value):new b.datetime()})},open:function(){var c=this.$input;this.timeView.open({offset:c.offset(),outerHeight:c.outerHeight(),outerWidth:c.outerWidth(),zIndex:b.getElementZIndex(c[0])})},close:function(){this.timeView.close()}};a.each(["min","max"],a.proxy(function(d,c){b.timepicker.prototype[c]=function(e){var f=c+"Value";if(e===undefined){return this[f].toDate()}var g=this.parse(e);if(g!==null){this[f]=g;this.timeView[c](g);if(!b.timeView.isInRange(this.selectedValue,this.minValue,this.maxValue)){this.value(g)}}}},this));a.fn.tTimePicker=function(c){return b.create(this,{name:"tTimePicker",init:function(d,e){return new b.timepicker(d,e)},options:c})};a.fn.tTimePicker.defaults={effects:b.fx.slide.defaults(),selectedValue:null,format:b.cultureInfo.shortTime,interval:30,enabled:true}})(jQuery);